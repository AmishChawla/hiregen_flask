{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}
{% block content %}
{% if current_user.company == None %}

<!-- Alerts -->
<div class="bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 dark:border-yellow-700 p-4 my-4">
  <div class="flex">
    <div class="flex-shrink-0">
      <svg class="h-5 w-5 text-yellow-400 dark:text-yellow-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.59 12.59a1.5 1.5 0 102.12-2.12M12 11.25V7.5m6.5 4.5l-.21-.21a1.5 1.5 0 10-2.12-2.12L16 10m0-5h4v4m-1.5-1.5l-.21-.21a1.5 1.5 0 10-2.12-2.12L16 3.5" />
      </svg>
    </div>
    <div class="ml-3">
      <p class="text-sm text-yellow-700 dark:text-yellow-300">
        Register your company to start posting jobs
        <a href="{{ url_for('company_register') }}" class="font-medium text-yellow-700 dark:text-yellow-300 hover:underline">here</a>.
      </p>
    </div>
  </div>
</div>
{% endif %}

<div class="py-6 px-4 sm:px-6 lg:px-8">
  <div class="min-h-screen py-6">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Dashboard</h1>
  <!-- Metric Cards -->
   <section class="grid md:grid-cols-2 xl:grid-cols-4 gap-6 mt-6">
                <div class="flex rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6">
                    <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 mr-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-briefcase h-6 w-6" viewBox="0 0 16 16">
  <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5m1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0M1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5"/>
</svg>
                    </div>
                    <div>
                        <span class="text-3xl font-bold text-gray-800 dark:text-white/90">{{ total_jobs }}</span>
                        <span class="block text-sm text-gray-500 dark:text-gray-400">Jobs</span>
                    </div>
                </div>
                <div class="flex rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6">
                    <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 mr-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text h-6 w-6" viewBox="0 0 16 16">
  <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"/>
  <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
</svg>
                    </div>
                    <div>
                        <span class="text-3xl font-bold text-gray-800 dark:text-white/90">{{ in_progress_jobs }}</span>
                        <span class="block text-sm text-gray-500 dark:text-gray-400">Active Jobs</span>
                    </div>
                </div>
                <div class="flex rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6">
                    <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 mr-6">
                       <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
                    </div>
                    <div>
                        <span class="text-3xl font-bold text-gray-800 dark:text-white/90">{{ applicants_count }}</span>
                        <span class="block text-sm text-gray-500 dark:text-gray-400">Applicants</span>
                    </div>
                </div>
                <div class="flex rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6">
                    <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 mr-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye h-6 w-6" viewBox="0 0 16 16">
  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
</svg>
                    </div>
                    <div>
                        <span class="text-3xl font-bold text-gray-800 dark:text-white/90">{{ total_views or 0 }}</span>
                        <span class="block text-sm text-gray-500 dark:text-gray-400">Total Views</span>
                    </div>
                </div>
</section>

    <!-- Charts Section -->
    <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2">
      <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6 h-64">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Job Status</h3>
        <canvas id="jobsChart" class="mt-6"></canvas>
      </div>
      <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6 h-64">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Hiring Pipeline</h3>
        <canvas id="applicantsChart" class="mt-6"></canvas>
      </div>
    </div>

    <!-- Latest Jobs Table -->
     {% if latest_jobs %}
    <div class="mt-6 rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6">
      <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Latest Jobs</h3>
    
      <div class="py-4 overflow-x-auto"> <!-- Added overflow-x-auto here -->
        <div class="min-w-full inline-block align-middle">
          <div class="overflow-hidden rounded-lg">
            <table class="min-w-full border-separate border-spacing-0">
              <thead class="bg-gray-50 dark:bg-gray-900">
                <tr>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Position</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Job Status</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Visibility</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Views</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Created Date</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Updated Date</th>
                  <th class="sticky top-0 z-10 border-b border-gray-300 bg-white/75 py-3.5 px-2 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter">Applicants</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                {% for data in latest_jobs %}
                  {% if data.status == 'published' %}
                  <tr>
                    <td class="px-6 py-2 whitespace-nowrap">
                      <a href="{{ url_for('admin_edit_post', job_id=data.id) }}" class="text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-200">{{ data.job_title }}</a>
                    </td>
                    <td class="px-6 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300">{{ data.job_opening_status }}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300">{{ data.status | capitalize }}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300 text-center">{{ data.job_opening_views }}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300">{{ data.created_at.split('T')[0] }}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-gray-700 dark:text-gray-300">{{ data.updated_at.split('T')[0] }}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-center">
                      <a href="{{ url_for('job_applicants', job_id=data.id) }}" class="text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-200">{{ data.applicant_count }}</a>
                    </td>
                  </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const jobsCtx = document.getElementById('jobsChart').getContext('2d');
new Chart(jobsCtx, {
    type: 'bar',
    data: {
        labels: ['Total Jobs', 'Active Jobs', 'Applicants'],
        datasets: [{
            data: [{{ total_jobs }}, {{ in_progress_jobs }}, {{ applicants_count }}],
            backgroundColor: ['#60A5FA', '#34D399', '#FCD34D'], // Softer colors: Blue, Green, Yellow
            borderRadius: 6, // Slightly rounded bar edges
            barPercentage: 0.5, // Reduce bar width (50% of the category width)
            categoryPercentage: 0.8, // Increase spacing between bars
        }]
    },
    options: {
        plugins: {
            legend: {
                display: false, // No legend needed
            },
            tooltip: {
                backgroundColor: '#1F2937', // Dark background for tooltips
                titleColor: '#FFFFFF',
                bodyColor: '#FFFFFF',
            },
        },
        scales: {
            x: {
                grid: {
                    display: false, // Remove horizontal grid lines
                },
                ticks: {
                    color: '#6B7280', // Tailwind gray-500 for text
                },
            },
            y: {
                grid: {
                    display: false, // Light gray grid lines
                },
                ticks: {
                    color: '#6B7280', // Tailwind gray-500 for text
                    stepSize: 1, // Increment by 1
                    beginAtZero: true,
                    max: Math.ceil(Math.max({{ total_jobs }}, {{ in_progress_jobs }}, {{ applicants_count }})) + 1, // Dynamically set max value
                },
            },
        },
        layout: {
            padding: 16, // Space around the chart
        },
        responsive: true,
        maintainAspectRatio: false, // Ensures charts fit within cards
    },
});

const applicantsCtx = document.getElementById('applicantsChart').getContext('2d');
new Chart(applicantsCtx, {
    type: 'bar',
    data: {
        labels: [{% for status in statuses %}'{{ status.name }}',{% endfor %}],
        datasets: [{
            data: [{% for status in statuses %}{{ status.applicant_count }},{% endfor %}],
            backgroundColor: ['#60A5FA', '#34D399', '#FCD34D', '#FB923C', '#F87171', '#A78BFA'], // Updated colors
            borderRadius: 6, // Slightly rounded bar edges
            barPercentage: 0.5, // Reduce bar width
            categoryPercentage: 0.8, // Increase spacing between bars
        }]
    },
    options: {
        plugins: {
            legend: {
                display: false, // No legend needed
            },
            tooltip: {
                backgroundColor: '#1F2937', // Dark background for tooltips
                titleColor: '#FFFFFF',
                bodyColor: '#FFFFFF',
            },
        },
        scales: {
            x: {
                grid: {
                    display: false, // Remove horizontal grid lines
                },
                ticks: {
                    color: '#6B7280', // Tailwind gray-500 for text
                },
            },
            y: {
                grid: {
                    display: false, // Light gray grid lines
                },
                ticks: {
                    color: '#6B7280', // Tailwind gray-500 for text
                    stepSize: 1, // Increment by 1
                    beginAtZero: true,
                    max: Math.ceil(Math.max({% for status in statuses %}{{ status.applicant_count }},{% endfor %})) + 1, // Dynamically set max value
                },
            },
        },
        layout: {
            padding: 16, // Space around the chart
        },
        responsive: true,
        maintainAspectRatio: false, // Ensures charts fit within cards
    },
});

</script>
{% endblock %}
