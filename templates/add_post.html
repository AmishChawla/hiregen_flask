{% extends 'base.html' %}

{% block title %}Add Job{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">

    <div class="px-4 py-10 sm:px-6 lg:px-8 lg:py-6">
      <form method="post" action="{{ url_for('add_post') }}" id="postForm" class="grid grid-cols-1 gap-6 lg:grid-cols-3">
        {{ form.hidden_tag() }}

        <!-- Middle Column: Job Fields -->
        <div class="col-span-2 bg-white dark:bg-gray-800 shadow rounded-lg p-6">
          <div id="errorMessages" class="mb-4 text-red-600 dark:text-red-400"></div>

          <div class="mb-4">
            <label for="job_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.job_title.label }}</label>
            {{ form.job_title(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="job_title", placeholder="Position") }}
            {% if form.job_title.errors %}
            <p class="mt-2 text-sm text-red-600 dark:text-red-400">{{ form.job_title.errors[0] }}</p>
            {% endif %}
          </div>

          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div>
              <label for="salary" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.salary.label }}</label>
              {{ form.salary(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
            <div>
              <label for="work_experience" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.work_experience.label }}</label>
              {{ form.work_experience(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
          </div>

          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 mt-4">
            <div>
              <label for="job_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.job_type.label }}</label>
              {{ form.job_type(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
            <div>
              <label for="industry" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.industry.label }}</label>
              {{ form.industry(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
          </div>

          <div class="mt-4">
            <label for="address_country" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.address_country.label }}</label>
            {{ form.address_country(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
          </div>

          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 mt-4">
            <div>
              <label for="address_province" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.address_province.label }}</label>
              {{ form.address_province(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
            <div>
              <label for="address_city" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.address_city.label }}</label>
              {{ form.address_city(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
            </div>
          </div>

          <div class="mt-4">
            <label for="address_postal_code" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.address_postal_code.label }}</label>
            {{ form.address_postal_code(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm") }}
          </div>

<div class="mt-4">
  <label for="job_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.job_description.label }}</label>
  <div class="relative">
    {{ form.job_description(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="job_description", rows="6") }}
    <button type="button" id="generateAI" class="flex absolute top-0 right-0 mt-2 mr-2 bg-indigo-600 text-white text-sm font-semibold px-3 py-1.5 rounded-md shadow-sm hover:bg-indigo-500 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="mt-1 mr-1 size-5 text-yellow-500">
  <path fill-rule="evenodd" d="M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z" clip-rule="evenodd" />
</svg>
     <p class=""> Generate by AI </p>
    </button>
  </div>
</div>


          <div class="mt-4">
            <label for="job_requirements" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.job_requirements.label }}</label>
            {{ form.job_requirements(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="job_requirements", rows="6") }}
          </div>

          <div class="mt-4">
            <label for="job_benefits" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.job_benefits.label }}</label>
            {{ form.job_benefits(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="job_benefits", rows="6") }}
          </div>
        </div>

        <!-- Third Column: Publish Options -->
        <aside class="col-span-1 bg-white dark:bg-gray-800 shadow rounded-lg p-6">
            <div class="mb-6">
      <h6 class="text-lg font-semibold text-gray-900 dark:text-gray-100">New Job</h6>
        </div>

          <div class="mb-6">
            {{form.publish(class="w-full rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900")}}
          </div>

          <div class="mb-6">
            {{ form.save_draft(class="w-full rounded-md bg-white dark:bg-gray-700 px-3 py-2 text-sm font-semibold text-gray-900 dark:text-gray-300 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900") }}
          </div>

          <div class="mb-4">
            <label for="target_date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.target_date.label }}</label>
            {{ form.target_date(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="target_date") }}
          </div>

          <div class="mb-4">
            <label for="opening_date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ form.opening_date.label }}</label>
            {{ form.opening_date(class="mt-1 block w-full rounded-md bg-white dark:bg-gray-700 px-3 py-1.5 text-gray-900 dark:text-gray-300 outline outline-1 -outline-offset-1 outline-gray-300 dark:outline-gray-600 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm", id="opening_date") }}
          </div>
        </aside>
      </form>
    </div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  document.getElementById('generateAI').addEventListener('click', function () {
    const jobTitle = document.getElementById('job_title').value;

    if (!jobTitle.trim()) {
      alert("Please fill in the Position field before generating the job description.");
      return;
    }

    fetch('/generate-ai-content', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ field: 'job_description', prompt: jobTitle })
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('job_description').value = data.content;
        } else {
          alert('Failed to generate content. Please try again.');
        }
      })
      .catch(error => {
        console.error('Error generating content:', error);
        alert('An error occurred while generating content.');
      });
  });
});
</script>
{% endblock %}
